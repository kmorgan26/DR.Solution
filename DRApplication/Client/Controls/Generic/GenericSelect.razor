@namespace DRApplication.Client.Controls
@using DRApplication.Shared.Requests
@inject IForeignKeyListService ForeignKeyListService

@if (!_isBusy)
{
    <MudSelect Variant="@VariantType" T="int" Label="@LabelText" ValueChanged="OnSelectListChanged">
        <MudSelectItem Value="0">@TopMenuItemText</MudSelectItem>
        @foreach (var item in _genericListVms)
        {
            <MudSelectItem Value="@item.Id">@item.Name</MudSelectItem>
        }

    </MudSelect>
}

@code {

    bool _isBusy;

    private IEnumerable<ForeignKeyListVm> _genericListVms { get; set; } = new List<ForeignKeyListVm>();

    [Parameter]
    public EventCallback<int> OnSelectListChanged { get; set; }

    /// <summary>
    /// Default Variant Type is "Outlined""
    /// </summary>
    [Parameter]
    public Variant VariantType { get; set; } = Variant.Outlined;

    /// <summary>
    /// Default Label is "ITEMS"
    /// </summary>
    [Parameter]
    public string LabelText { get; set; } = "Items";

    /// <summary>
    /// Default Text is "SELECT ONE";
    /// </summary>
    [Parameter]
    public string TopMenuItemText { get; set; } = "SELECT ONE";

    /// <summary>
    /// Must provide a List Type that is part of the Enum and incorporated in the Generic List Service
    /// </summary>
    [Parameter]
    public ForeignKeyListRequest Request { get; set; }

    [Parameter]
    public int ForeignKeyValue { get; set; }

    [Parameter]
    public string ForeignKeyName { get; set; }

    [Parameter]
    public string TableName { get; set; }

    private async Task SetRequest()
    {
        Request = new ForeignKeyListRequest()
        {
            TableName = TableName,
            ForeignKeyName = ForeignKeyName,
            ForeignKeyValue = ForeignKeyValue.ToString()
        };
    }

    private async Task GetGenericListVms()
    {
        var items = await ForeignKeyListService.GetForeignKeyListVmsFromPlatformListName(Request);
        _genericListVms = items;
    }

    protected override async Task OnInitializedAsync()
    {
        _isBusy = true;
        await SetRequest();
        await GetGenericListVms();
        _isBusy = false;
    }
}