@namespace DRApplication.Client.Pages.Platforms
@page "/maintainers"

@inject MaintainerManager _db

<TitleHeader IconPath="@Icons.Material.Filled.LocalAirport" TitleText="Maintainers" />

<NewButton Url="/maintainer/create" />
@if (!_isBusy)
{
    <FSMudTable TableItems="_viewModels" TItem="MaintainerVm">
        <FSHeaderContent>
            <MudTh>Id</MudTh>
            <MudTh>Maintainer</MudTh>
        </FSHeaderContent>
        <FSRowTemplate>
            <MudTd DataLabel="Id">@context.Id</MudTd>
            <MudTd DataLabel="Maintainer">@context.Maintainer</MudTd>
        </FSRowTemplate>
    </FSMudTable>
    
}

@code{
    bool _isBusy;
    public IEnumerable<MaintainerVm>? _viewModels { get; set; }
    

    protected override async Task OnInitializedAsync()
    {
        _isBusy = true;
        var models = await _db.GetAllAsync();
        _viewModels = Mapping.Mapper.Map<IEnumerable<MaintainerVm>>(models);
        _isBusy = false;
    }
    
    private List<string> _editEvents = new();

    private void SaveChanges(MaintainerVm maintainerVm)
    {
        var maintainer = Mapping.Mapper.Map<Maintainer>(maintainerVm);
        _db.UpdateAsync(maintainer);
    }
}